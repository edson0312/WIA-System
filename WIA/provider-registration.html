<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WIA - Provider Registration</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/proposal-list.css">
    <link rel="icon" href="img/LOGO.png" type="image/png">
    <style>
        .form-container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
        }
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
            gap: 15px;
        }
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        .form-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 30px;
            gap: 10px;
        }
        .btn-save, .btn-cancel, .btn-edit, .btn-delete, .btn-add, .btn-remove {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-save {
            background-color: #4CAF50;
            color: white;
        }
        .btn-edit {
            background-color: #2196F3;
            color: white;
        }
        .btn-delete {
            background-color: #f44336;
            color: white;
        }
        .btn-cancel {
            background-color: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
        }
        .btn-add {
            background-color: #2196F3;
            color: white;
            padding: 5px 10px;
            margin-left: auto;
        }
        .btn-remove {
            background-color: #f44336;
            color: white;
            padding: 5px 10px;
        }
        .section-title {
            margin-top: 20px;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
            color: #333;
        }
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .dynamic-section {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            position: relative;
        }
        .dynamic-section .btn-remove {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        /* Menu Dropdown Styles */
        .menu-dropdown {
            position: relative;
            display: inline-block;
            margin-right: 15px;
        }
        .menu-icon {
            font-size: 20px;
            cursor: pointer;
            color: #333;
            padding: 5px;
        }
        .menu-dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }
        .menu-dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }
        .menu-dropdown-content a:hover {
            background-color: #f1f1f1;
        }
        .menu-dropdown:hover .menu-dropdown-content {
            display: block;
        }
        .menu-dropdown-content a.active {
            background-color: #ddd;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <img src="img/LOGO-Horizontal.png" alt="WIA Logo" class="header-logo">
            <div class="menu-dropdown">
                <span class="menu-icon">â˜°</span>
                <div class="menu-dropdown-content">
                    <a href="proposal-list.html">Proposals</a>
                    <a href="collections.html">Collections</a>
                    <a href="payouts.html">Payouts</a>
                    <a href="sales-report.html">Sales Report</a>
                    <a href="remittance-provider.html">Remittance to Provider</a>
                    <a href="rejected.html">Rejected</a>
                    <a href="user-list.html">User</a>
                    <a href="agent-list.html">Agent</a>
                    <a href="customer-list.html">Customer</a>
                    <a href="provider-list.html" class="active">Provider</a>
                </div>
            </div>
        </div>
        <div class="header-right">
            <div class="user-menu">
                <span class="username">John Doe</span>
                <div class="dropdown-content">
                    <a href="#">Profile</a>
                    <a href="#">Settings</a>
                    <a href="index.html">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="title-container">
            <h1 id="pageTitle">Provider Registration</h1>
        </div>
        <div class="form-container">
            <form id="providerForm">
                <input type="hidden" id="providerCode" name="providerCode" value="">
                
                <!-- Row 1: Company Information -->
                <h3 class="section-title">Company Information</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="companyName">Company Name</label>
                        <input type="text" id="companyName" name="companyName" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group" style="flex: 1 0 100%;">
                        <label for="companyAddress">Company Address</label>
                        <textarea id="companyAddress" name="companyAddress" required></textarea>
                    </div>
                </div>

                <!-- Row 2: Company Contacts -->
                <h3 class="section-title">Company Contacts</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="telephone">Tel. No/Mobile No.</label>
                        <input type="tel" id="telephone" name="telephone" placeholder="+63xxxxxxxxxx" required>
                    </div>
                    <div class="form-group">
                        <label for="website">Website</label>
                        <input type="text" id="website" name="website" placeholder="www.example.com">
                    </div>
                    <div class="form-group">
                        <label for="fbPage">FB Page</label>
                        <input type="text" id="fbPage" name="fbPage" placeholder="Facebook page URL or username">
                    </div>
                    <div class="form-group">
                        <label for="companyEmail">Email</label>
                        <input type="email" id="companyEmail" name="companyEmail" required>
                    </div>
                </div>

                <!-- Row 3: Contact Persons -->
                <div class="section-header">
                    <h3 class="section-title">Contact Persons</h3>
                    <button type="button" id="addContactBtn" class="btn-add">Add Contact</button>
                </div>
                <div id="contactPersonsContainer">
                    <!-- Dynamic contact person sections will be added here -->
                    <div class="dynamic-section contact-person">
                        <button type="button" class="btn-remove" data-action="remove-contact">Remove</button>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="contactName1">Name</label>
                                <input type="text" id="contactName1" name="contactName1" required>
                            </div>
                            <div class="form-group">
                                <label for="contactDesignation1">Designation</label>
                                <input type="text" id="contactDesignation1" name="contactDesignation1" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="contactNo1">Contact No.</label>
                                <input type="tel" id="contactNo1" name="contactNo1" placeholder="+63xxxxxxxxxx" required>
                            </div>
                            <div class="form-group">
                                <label for="contactEmail1">Email</label>
                                <input type="email" id="contactEmail1" name="contactEmail1" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="flex: 1 0 100%;">
                                <label for="contactNotes1">Notes</label>
                                <textarea id="contactNotes1" name="contactNotes1" rows="2"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bank Accounts -->
                <h3 class="section-title">Bank Account</h3>
                <div class="subheader">
                    <span>Account Information</span>
                    <!-- Removing the Add Bank Account button -->
                </div>
                <div id="bankAccountsContainer">
                    <div class="bank-account" data-index="1">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="bankName1">Bank Name</label>
                                <input type="text" id="bankName1" name="bankName1" required>
                            </div>
                            <div class="form-group">
                                <label for="accountName1">Account Name</label>
                                <input type="text" id="accountName1" name="accountName1" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="accountNo1">Account No.</label>
                                <input type="text" id="accountNo1" name="accountNo1" required>
                            </div>
                            <div class="form-group">
                                <label for="accountType1">Type of Account</label>
                                <select id="accountType1" name="accountType1" required>
                                    <option value="" disabled selected>Select Account Type</option>
                                    <option value="Savings">Savings</option>
                                    <option value="Current">Current</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Form Actions -->
                <div id="newFormActions" class="form-actions">
                    <button type="button" id="saveBtn" class="btn-save">Save</button>
                    <button type="button" id="cancelBtn" class="btn-cancel">Cancel</button>
                </div>
                
                <div id="viewFormActions" class="form-actions" style="display: none;">
                    <button type="button" id="editBtn" class="btn-edit">Edit</button>
                    <button type="button" id="deleteBtn" class="btn-delete">Delete</button>
                    <button type="button" id="cancelViewBtn" class="btn-cancel">Cancel</button>
                </div>
                
                <div id="editFormActions" class="form-actions" style="display: none;">
                    <button type="button" id="saveEditBtn" class="btn-save">Save</button>
                    <button type="button" id="cancelEditBtn" class="btn-cancel">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const providerForm = document.getElementById('providerForm');
            const pageTitle = document.getElementById('pageTitle');
            const contactPersonsContainer = document.getElementById('contactPersonsContainer');
            const bankAccountsContainer = document.getElementById('bankAccountsContainer');
            
            // Action buttons
            const addContactBtn = document.getElementById('addContactBtn');
            const addBankBtn = document.getElementById('addBankBtn');
            const saveBtn = document.getElementById('saveBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const editBtn = document.getElementById('editBtn');
            const deleteBtn = document.getElementById('deleteBtn');
            const cancelViewBtn = document.getElementById('cancelViewBtn');
            const saveEditBtn = document.getElementById('saveEditBtn');
            const cancelEditBtn = document.getElementById('cancelEditBtn');
            
            // Action divs
            const newFormActions = document.getElementById('newFormActions');
            const viewFormActions = document.getElementById('viewFormActions');
            const editFormActions = document.getElementById('editFormActions');
            
            // Get URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const providerCode = urlParams.get('providerCode');
            const mode = urlParams.get('mode');
            
            // Test provider data
            const testProviders = {
                'PROVIDER001': {
                    providerCode: 'PROVIDER001',
                    companyName: 'AISCIA Insurance Corporation',
                    companyAddress: '123 Main Street, Makati City, Metro Manila, Philippines',
                    telephone: '+6328123456',
                    website: 'www.aiscia.com.ph',
                    fbPage: 'aiscia.insurance',
                    companyEmail: 'info@aiscia.com.ph',
                    contacts: [
                        {
                            name: 'Juan Dela Cruz',
                            designation: 'Account Manager',
                            contactNo: '+639123456789',
                            email: 'juan.delacruz@aiscia.com.ph',
                            notes: 'Primary contact for all policy matters.'
                        },
                        {
                            name: 'Maria Santos',
                            designation: 'Claims Officer',
                            contactNo: '+639987654321',
                            email: 'maria.santos@aiscia.com.ph',
                            notes: 'Contact for claims processing.'
                        }
                    ],
                    bankAccounts: [
                        {
                            bankName: 'BDO Unibank',
                            accountName: 'AISCIA Insurance Corporation',
                            accountNo: '1234567890',
                            accountType: 'Current'
                        }
                    ]
                },
                'PROVIDER002': {
                    providerCode: 'PROVIDER002',
                    companyName: 'MG Insurance Company',
                    companyAddress: '456 Finance Avenue, Taguig City, Metro Manila, Philippines',
                    telephone: '+6328987654',
                    website: 'www.mginsurance.com.ph',
                    fbPage: 'mginsurance.official',
                    companyEmail: 'contact@mginsurance.com.ph',
                    contacts: [
                        {
                            name: 'Robert Garcia',
                            designation: 'Regional Director',
                            contactNo: '+639567891234',
                            email: 'robert.garcia@mginsurance.com.ph',
                            notes: 'Decision maker for partnerships.'
                        }
                    ],
                    bankAccounts: [
                        {
                            bankName: 'Bank of the Philippine Islands',
                            accountName: 'MG Insurance Company',
                            accountNo: '0987654321',
                            accountType: 'Current'
                        },
                        {
                            bankName: 'Metropolitan Bank & Trust Company',
                            accountName: 'MG Insurance Company',
                            accountNo: '5678901234',
                            accountType: 'Savings'
                        }
                    ]
                },
                'PROVIDER003': {
                    providerCode: 'PROVIDER003',
                    companyName: 'MGAC Philippines Insurance Corp.',
                    companyAddress: '789 Corporate Tower, Ortigas Center, Pasig City, Metro Manila, Philippines',
                    telephone: '+6328765432',
                    website: 'www.mgacphil.com',
                    fbPage: 'mgacphilippines',
                    companyEmail: 'inquiries@mgacphil.com',
                    contacts: [
                        {
                            name: 'Emily Reyes',
                            designation: 'Head of Business Development',
                            contactNo: '+639234567890',
                            email: 'emily.reyes@mgacphil.com',
                            notes: 'Main contact for new business opportunities and partnerships.'
                        },
                        {
                            name: 'Daniel Tan',
                            designation: 'Finance Manager',
                            contactNo: '+639345678901',
                            email: 'daniel.tan@mgacphil.com',
                            notes: 'Contact for all payment and financial matters.'
                        },
                        {
                            name: 'Sofia Cruz',
                            designation: 'Customer Service Manager',
                            contactNo: '+639456789012',
                            email: 'sofia.cruz@mgacphil.com',
                            notes: 'Handles client concerns and policy inquiries.'
                        }
                    ],
                    bankAccounts: [
                        {
                            bankName: 'Security Bank',
                            accountName: 'MGAC Philippines Insurance Corp.',
                            accountNo: '1357924680',
                            accountType: 'Current'
                        },
                        {
                            bankName: 'UnionBank of the Philippines',
                            accountName: 'MGAC Philippines Insurance Corp.',
                            accountNo: '2468013579',
                            accountType: 'Current'
                        }
                    ]
                },
                'PROVIDER004': {
                    providerCode: 'PROVIDER004',
                    companyName: 'Pacific Life Insurance',
                    companyAddress: '321 Sunset Boulevard, Alabang, Muntinlupa City, Metro Manila, Philippines',
                    telephone: '+6328654321',
                    website: 'www.pacificlifeinsurance.com.ph',
                    fbPage: 'pacificlifeinsuranceph',
                    companyEmail: 'support@pacificlifeinsurance.com.ph',
                    contacts: [
                        {
                            name: 'Michael Lim',
                            designation: 'Chief Executive Officer',
                            contactNo: '+639567890123',
                            email: 'michael.lim@pacificlifeinsurance.com.ph',
                            notes: 'Executive contact for major partnerships and strategic decisions.'
                        },
                        {
                            name: 'Patricia Gomez',
                            designation: 'Operations Manager',
                            contactNo: '+639678901234',
                            email: 'patricia.gomez@pacificlifeinsurance.com.ph',
                            notes: 'Handles day-to-day operations and policy processing.'
                        }
                    ],
                    bankAccounts: [
                        {
                            bankName: 'Land Bank of the Philippines',
                            accountName: 'Pacific Life Insurance Co.',
                            accountNo: '3691215487',
                            accountType: 'Current'
                        }
                    ]
                }
            };
            
            // Contact ID and Bank ID counters
            let contactCounter = 1;
            let bankCounter = 1;
            
            // Validation functions
            function validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }
            
            function validatePhoneNumber(phone) {
                // Allow + and digits
                const re = /^[+]?[0-9]+$/;
                return re.test(phone);
            }
            
            // Event handlers for input validation
            document.getElementById('telephone').addEventListener('input', function() {
                validateInput(this, validatePhoneNumber, 'Please enter a valid phone number. Only numbers and + sign are allowed.');
            });
            
            document.getElementById('companyEmail').addEventListener('input', function() {
                validateInput(this, validateEmail, 'Please enter a valid email address.');
            });
            
            document.getElementById('accountNo1').addEventListener('input', function() {
                validateNumericInput(this, 'Please enter numbers only for account number.');
            });
            
            // Add event listeners for dynamic elements
            document.getElementById('contactNo1').addEventListener('input', function() {
                validateInput(this, validatePhoneNumber, 'Please enter a valid phone number. Only numbers and + sign are allowed.');
            });
            
            document.getElementById('contactEmail1').addEventListener('input', function() {
                validateInput(this, validateEmail, 'Please enter a valid email address.');
            });
            
            // Validation helper function
            function validateInput(element, validationFn, errorMessage) {
                const value = element.value;
                if (value && !validationFn(value)) {
                    element.setCustomValidity(errorMessage);
                } else {
                    element.setCustomValidity('');
                }
            }
            
            // Numeric input validation
            function validateNumericInput(element, errorMessage) {
                const value = element.value;
                const re = /^[0-9]+$/;
                if (value && !re.test(value)) {
                    element.setCustomValidity(errorMessage);
                } else {
                    element.setCustomValidity('');
                }
            }
            
            // Function to load provider data
            function loadProviderData(providerCode) {
                // If test data exists for the provider code
                if (testProviders[providerCode]) {
                    const providerData = testProviders[providerCode];
                    
                    // Set form fields
                    document.getElementById('providerCode').value = providerData.providerCode;
                    document.getElementById('companyName').value = providerData.companyName;
                    document.getElementById('companyAddress').value = providerData.companyAddress;
                    document.getElementById('telephone').value = providerData.telephone;
                    document.getElementById('website').value = providerData.website;
                    document.getElementById('fbPage').value = providerData.fbPage;
                    document.getElementById('companyEmail').value = providerData.companyEmail;
                    
                    // Clear existing contact persons and add from the data
                    contactPersonsContainer.innerHTML = '';
                    if (providerData.contacts && providerData.contacts.length > 0) {
                        providerData.contacts.forEach((contact, index) => {
                            // Create a new contact section with the data
                            addContactPerson(index + 1, contact);
                        });
                    } else {
                        // Add a blank contact person if none exist
                        addContactPerson(1);
                    }
                    
                    // Set bank account data (only the first one)
                    if (providerData.bankAccounts && providerData.bankAccounts.length > 0) {
                        const account = providerData.bankAccounts[0];
                        document.getElementById('bankName1').value = account.bankName;
                        document.getElementById('accountName1').value = account.accountName;
                        document.getElementById('accountNo1').value = account.accountNo;
                        document.getElementById('accountType1').value = account.accountType;
                    }
                    
                    return true;
                }
                return false;
            }
            
            // Function to add a contact person with optional data
            function addContactPerson(index, contactData = null) {
                const contactDiv = document.createElement('div');
                contactDiv.className = 'contact-person';
                contactDiv.dataset.index = index;
                
                contactDiv.innerHTML = `
                    <div class="contact-header">
                        <h4>Contact Person ${index}</h4>
                        ${index > 1 ? '<button type="button" class="btn-remove remove-contact">Remove</button>' : ''}
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contactName${index}">Name</label>
                            <input type="text" id="contactName${index}" name="contactName${index}" value="${contactData ? contactData.name : ''}" required>
                        </div>
                        <div class="form-group">
                            <label for="designation${index}">Designation</label>
                            <input type="text" id="designation${index}" name="designation${index}" value="${contactData ? contactData.designation : ''}" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contactNo${index}">Contact No.</label>
                            <input type="tel" id="contactNo${index}" name="contactNo${index}" value="${contactData ? contactData.contactNo : ''}" required>
                        </div>
                        <div class="form-group">
                            <label for="contactEmail${index}">Email</label>
                            <input type="email" id="contactEmail${index}" name="contactEmail${index}" value="${contactData ? contactData.email : ''}" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1 0 100%;">
                            <label for="notes${index}">Notes</label>
                            <textarea id="notes${index}" name="notes${index}" rows="2">${contactData ? contactData.notes : ''}</textarea>
                        </div>
                    </div>
                `;
                
                contactPersonsContainer.appendChild(contactDiv);
                
                // Add remove button event listener
                const removeButton = contactDiv.querySelector('.remove-contact');
                if (removeButton) {
                    removeButton.addEventListener('click', function() {
                        contactDiv.remove();
                    });
                }
            }
            
            // Load test data if in view or edit mode
            if (mode === 'view' || mode === 'edit') {
                if (providerCode && loadProviderData(providerCode)) {
                    // Update page title and form mode
                    pageTitle.textContent = mode === 'view' ? 'View Provider' : 'Edit Provider';
                    
                    // Show appropriate action buttons
                    newFormActions.style.display = 'none';
                    if (mode === 'view') {
                        viewFormActions.style.display = 'flex';
                        // Disable all form fields in view mode
                        Array.from(providerForm.elements).forEach(element => {
                            if (element.tagName !== 'BUTTON') {
                                element.disabled = true;
                            }
                        });
                    } else {
                        editFormActions.style.display = 'flex';
                    }
                } else {
                    alert('Provider not found!');
                    window.location.href = 'provider-list.html';
                }
            } else {
                // If in new mode, set a default provider code
                document.getElementById('providerCode').value = 'PROVIDER' + Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                
                // Load first test provider data for demonstration in new mode
                if (Object.keys(testProviders).length > 0) {
                    loadProviderData(Object.keys(testProviders)[0]);
                } else {
                    // Add initial blank contact person and bank account
                    addContactPerson(1);
                }
            }
            
            // Add event listeners for add buttons
            addContactBtn.addEventListener('click', function() {
                const contactPersons = document.querySelectorAll('.contact-person');
                addContactPerson(contactPersons.length + 1);
            });
            
            // Enable form fields for editing
            function enableFormFields() {
                const formElements = providerForm.elements;
                for (let i = 0; i < formElements.length; i++) {
                    formElements[i].disabled = false;
                }
                
                // Re-enable add buttons
                addContactBtn.disabled = false;
                
                // Re-enable remove buttons
                const removeButtons = document.querySelectorAll('.btn-remove');
                removeButtons.forEach(btn => {
                    btn.disabled = false;
                });
                
                // Keep providerCode disabled
                document.getElementById('providerCode').disabled = true;
                
                // For bank name selects, repopulate with all options
                const bankSelects = document.querySelectorAll('select[id^="bankName"]');
                bankSelects.forEach(select => {
                    const selectedValue = select.value;
                    select.innerHTML = `
                        <option value="" disabled>Select Bank</option>
                        <option value="BDO Unibank">BDO Unibank</option>
                        <option value="Bank of the Philippine Islands">Bank of the Philippine Islands (BPI)</option>
                        <option value="Metropolitan Bank & Trust Company">Metropolitan Bank & Trust Company (Metrobank)</option>
                        <option value="Land Bank of the Philippines">Land Bank of the Philippines</option>
                        <option value="Philippine National Bank">Philippine National Bank (PNB)</option>
                        <option value="Security Bank">Security Bank</option>
                        <option value="China Banking Corporation">China Banking Corporation (China Bank)</option>
                        <option value="UnionBank of the Philippines">UnionBank of the Philippines</option>
                        <option value="Rizal Commercial Banking Corporation">Rizal Commercial Banking Corporation (RCBC)</option>
                        <option value="Development Bank of the Philippines">Development Bank of the Philippines (DBP)</option>
                        <option value="EastWest Bank">EastWest Bank</option>
                        <option value="Asia United Bank">Asia United Bank (AUB)</option>
                        <option value="United Coconut Planters Bank">United Coconut Planters Bank (UCPB)</option>
                        <option value="Maybank Philippines">Maybank Philippines</option>
                        <option value="Bank of Commerce">Bank of Commerce</option>
                    `;
                    
                    // Reselect the previously selected value
                    for (let i = 0; i < select.options.length; i++) {
                        if (select.options[i].value === selectedValue) {
                            select.selectedIndex = i;
                            break;
                        }
                    }
                });
                
                // For account type selects, repopulate with all options
                const accountTypeSelects = document.querySelectorAll('select[id^="accountType"]');
                accountTypeSelects.forEach(select => {
                    const selectedValue = select.value;
                    select.innerHTML = `
                        <option value="" disabled>Select Account Type</option>
                        <option value="Savings">Savings</option>
                        <option value="Current">Current</option>
                    `;
                    
                    // Reselect the previously selected value
                    for (let i = 0; i < select.options.length; i++) {
                        if (select.options[i].value === selectedValue) {
                            select.selectedIndex = i;
                            break;
                        }
                    }
                });
            }
            
            // Cancel button handler
            cancelBtn.addEventListener('click', function() {
                if (window.parent && window.parent.location.pathname.includes('provider-list.html')) {
                    window.parent.postMessage('close_popup', '*');
                } else {
                    window.location.href = 'provider-list.html';
                }
            });
            
            // Cancel View button handler
            cancelViewBtn.addEventListener('click', function() {
                if (window.parent && window.parent.location.pathname.includes('provider-list.html')) {
                    window.parent.postMessage('close_popup', '*');
                } else {
                    window.location.href = 'provider-list.html';
                }
            });
            
            // Cancel Edit button handler
            cancelEditBtn.addEventListener('click', function() {
                // Switch back to view mode
                viewFormActions.style.display = 'flex';
                editFormActions.style.display = 'none';
                
                // Reload the page to reset the form
                location.reload();
            });
            
            // Edit button handler
            editBtn.addEventListener('click', function() {
                // Switch to edit mode
                viewFormActions.style.display = 'none';
                editFormActions.style.display = 'flex';
                
                // Enable all form fields
                enableFormFields();
            });
            
            // Delete button handler
            deleteBtn.addEventListener('click', function() {
                if (confirm(`Are you sure you want to delete provider ${providerCode}?`)) {
                    alert(`Provider ${providerCode} has been deleted.`);
                    
                    // Notify parent window if in iframe
                    if (window.parent && window.parent.location.pathname.includes('provider-list.html')) {
                        window.parent.postMessage('provider_deleted', '*');
                    } else {
                        window.location.href = 'provider-list.html';
                    }
                }
            });
            
            // Save button handler (new provider)
            saveBtn.addEventListener('click', function() {
                if (providerForm.checkValidity()) {
                    // Generate a new provider code
                    const newProviderCode = 'PROVIDER' + String(Math.floor(Math.random() * 10000)).padStart(3, '0');
                    
                    alert(`Provider ${newProviderCode} has been created successfully.`);
                    window.location.href = 'provider-list.html';
                } else {
                    providerForm.reportValidity();
                }
            });
            
            // Save Edit button handler
            saveEditBtn.addEventListener('click', function() {
                if (providerForm.checkValidity()) {
                    alert(`Provider ${providerCode} has been updated successfully.`);
                    
                    // Notify parent window if in iframe
                    if (window.parent && window.parent.location.pathname.includes('provider-list.html')) {
                        window.parent.postMessage('provider_updated', '*');
                    } else {
                        window.location.href = 'provider-list.html';
                    }
                } else {
                    providerForm.reportValidity();
                }
            });
        });
    </script>
</body>
</html> 